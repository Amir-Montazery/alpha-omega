{% extends "base.html" %}

{% load translate %}

{% block title %}Policy Mapping{% endblock %}

{% block body %}

<h3>Policy Evaluation Summary</h3>
<p>
    This page contains a summary of all policy evaluations. To see the details of a policy evaluation, click on the
    the policy name.
    This site contains information on Assurance Assertions and Policies for a broad set of open source projects, generated by
    the OpenSSF Alpha-Omega project. To get started, search for a package or project below.
</p>


<table class="table table table-hover policy-evaluation-table">
    <thead>
        <tr>
            <th>Policy Name</th>
            <th class="text-center">Total Evaluations</th>
            <th class="text-center">Pass Rate</th>
        </tr>
    </thead>
    <tbody>
        {% for policy in policies %}
        {% with total=policy.is_passed|add:policy.is_failed %}
            <tr data-policy-identifier="{{ policy.identifier }}">
                <td>{{ policy.name }}</td>
                <td class="text-center">{{ total|floatformat:"g" }}</a></td>
                <td class="text-center">
                    <div class="progress" role="progressbar" aria-label="Progress bar for {{ policy.identifier }}" aria-valuenow="{{ policy.is_passed }}" aria-valuemin="0" aria-valuemax="{{ total }}" style="height: 22px">
                        {% if policy.is_passed|percentage:total < 20 %}
                            <div class="progress-bar bg-danger" style="width: {{ policy.is_passed|percentage:total|floatformat:"0" }}%">{{ policy.is_passed|percentage:total|floatformat:"0" }}%</div>
                        {% elif policy.is_passed|percentage:total < 60 %}
                            <div class="progress-bar bg-warning" style="color: #000; width: {{ policy.is_passed|percentage:total|floatformat:"0" }}%">{{ policy.is_passed|percentage:total|floatformat:"0" }}%</div>
                        {% else %}
                            <div class="progress-bar bg-success" style="width: {{ policy.is_passed|percentage:total|floatformat:"0" }}%">{{ policy.is_passed|percentage:total|floatformat:"0" }}%</div>
                        {% endif %}
                    </div>
                </td>
            </tr>
        {% endwith %}
    </tbody>
    {% endfor %}
</table>
{% endblock %}

{% block javascript %}
    $(document).ready(() => {
        // Make the table rows clickable
        $('table.policy-evaluation-table tbody tr').css('cursor', 'pointer');

        $('table.policy-evaluation-table tbody td').on('click', (e) => {
            const policy_identifier = $(e.currentTarget).closest('tr').data('policy-identifier');
            window.location.href = '/policy/detail?policy_identifier=' + policy_identifier;
        });
    })
{% endblock javascript %}
